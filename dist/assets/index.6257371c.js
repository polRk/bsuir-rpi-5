var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,r,a)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[r]=a,c=(e,t)=>{for(var r in t||(t={}))n.call(t,r)&&l(e,r,t[r]);if(a)for(var r of a(t))s.call(t,r)&&l(e,r,t[r]);return e};import{r as o,R as u,a as i}from"./vendor.f26940bd.js";const g=o.exports.createContext({apiKey:"",pageSize:20,search:"",language:navigator.language.slice(0,2),sourceIds:[]}),p=()=>{const{apiKey:e,pageSize:t}=o.exports.useContext(g);return{getSourcesQuery:function(e={}){return new URLSearchParams(c({},e))},getSources:function(t={}){const r=this.getSourcesQuery(t);r.append("apiKey",e);return fetch(`https://newsapi.org/v2/sources?${r}`).then((e=>e.json()))},getArticlesQuery:function(e={}){const r=new URLSearchParams,{search:a,sources:n,domains:s,excludeDomains:l,from:o,to:u,language:i,sortBy:g,page:p,pageSize:m}=c({page:1,pageSize:t},e);return a&&r.append("q",a),n&&r.append("sources",n.join(",")),s&&r.append("domains",s.join(",")),l&&r.append("excludeDomains",l.join(",")),o&&r.append("from",o.toISOString()),u&&r.append("to",u.toISOString()),i&&r.append("language",i),g&&r.append("sortBy",g),m&&r.append("pageSize",m.toString()),p&&r.append("page",p.toString()),r},getArticles:function(t={}){const r=this.getArticlesQuery(t);r.append("apiKey",e);return fetch(`https://newsapi.org/v2/everything?${r}`).then((e=>e.json()))}}},m=()=>{const e=p();function t(e,t){const r=JSON.stringify({updatedAt:new Date,result:t});localStorage.setItem(e,r),setTimeout((()=>localStorage.removeItem(e)),3e5)}function r(e){const t=JSON.parse(localStorage.getItem(e)||"null");return!t||(new Date).getTime()-new Date(t.updatedAt).getTime()>3e5?null:t.result}return{getSources:async a=>{const n=`/v2/sources?${e.getSourcesQuery(a)}`,s=r(n);return s||e.getSources(a).then((e=>("ok"===e.status&&t(n,e),e)))},getArticles:async a=>{const n=`/v2/everything?${e.getArticlesQuery(a)}`,s=r(n);return s||e.getArticles(a).then((e=>("ok"===e.status&&t(n,e),e)))}}},f=({pageSize:e})=>{const[a,n]=o.exports.useState([]),{getArticles:s}=m(),l=o.exports.useCallback((e=>{let t=!1;return s(e).then((e=>{if("error"===e.status)return alert(e.message),void(t||n([]));t||n(e.articles)})),()=>{t=!0}}),[s]),u=o.exports.useCallback((l=>{let o=!1;const u=Math.floor(a.length/e)+1;var i,g;return s((i=c({},l),g={page:u},t(i,r(g)))).then((e=>{"error"===e.status?alert(e.message):o||n(a.concat(e.articles))})),()=>{o=!0}}),[a,s]);return{articles:a,fetchArticles:l,fetchMoreArticles:u}},h=({article:e})=>{const t=new URL(e.url);return u.createElement("li",null,u.createElement("a",{href:e.url,target:"_blank",className:"text-blue-700"},u.createElement("h2",{className:"text-lg font-bold"},e.title)),u.createElement("a",{href:e.url,className:"flex gap-1 items-center"},u.createElement("img",{src:`https://s2.googleusercontent.com/s2/favicons?domain=${t.hostname}`,alt:"favicon"}),u.createElement("span",{className:"flex-1 text-green-700 font-bold clip"},t.hostname,u.createElement("span",{className:"font-medium"},t.pathname)),u.createElement("span",{className:"text-gray-500"},new Date(e.publishedAt).toLocaleString())),u.createElement("p",null,e.description))},d=({articles:e,fetchMoreArticles:t})=>{const r=o.exports.useRef(null),{language:a,search:n,sourceIds:s}=o.exports.useContext(g),l=e=>{if(e.find((e=>e.intersectionRatio)))return t({language:a,search:n,sources:s})};return o.exports.useEffect((()=>{if(!e.length)return;const t=new IntersectionObserver(l);return r.current&&t.observe(r.current),()=>{r.current&&t.unobserve(r.current)}}),[e,r.current]),u.createElement("div",{id:"article",className:"flex flex-col max-w-screen-sm"},u.createElement("ol",{className:"flex flex-col gap-4"},e.map((e=>u.createElement(h,{key:e.url,article:e})))),u.createElement("div",{className:"sentinel",ref:r}))},x=()=>{const{language:e,search:t,sourceIds:r,pageSize:a}=o.exports.useContext(g),{articles:n,fetchArticles:s,fetchMoreArticles:l}=f({pageSize:a});return o.exports.useEffect((()=>{(t||r.length)&&s({language:e,search:t,sources:r})}),[e,t,r]),u.createElement(d,{articles:n,fetchMoreArticles:l})},S=({language:e,languages:t,onSelect:r})=>u.createElement("div",{id:"language",className:"flex flex-col w-full"},u.createElement("label",{htmlFor:"language__control",className:"text-sm font-bold"},"Language: "),u.createElement("select",{id:"language__control",name:"language",value:e,onChange:e=>{const a=t[e.target.selectedIndex];null==r||r(a)}},t.map((e=>u.createElement("option",{key:e,value:e,className:"capitalize"},e))))),E=({onChange:e})=>{const{language:t}=o.exports.useContext(g);return u.createElement(S,{language:t,languages:["ar","de","en","es","fr","he","it","nl","no","pt","ru","se","ud","zh"],onSelect:e})},v=({search:e,onInput:t})=>u.createElement("div",{id:"search",className:"flex flex-col w-full"},u.createElement("label",{htmlFor:"search__control",className:"text-sm font-bold"},"Search: "),u.createElement("input",{id:"search__control",type:"search",placeholder:"Search ...",value:e,onChange:e=>{null==t||t(e.target.value)}})),y=({onChange:e})=>{const{search:t}=o.exports.useContext(g);return u.createElement(v,{search:t,onInput:e})},b=({sources:e,onSelect:t})=>u.createElement("div",{id:"source",className:"flex flex-col w-full h-full"},u.createElement("label",{htmlFor:"source__control",className:"text-sm font-bold"},"Sources: "),u.createElement("select",{name:"source[]",multiple:!0,className:"h-full",onChange:e=>{const r=[...e.target.selectedOptions].map((e=>e.value));null==t||t(r)}},e.map((({id:e,name:t})=>u.createElement("option",{key:e,value:e},t))))),N=({onChange:e})=>{const{language:t}=o.exports.useContext(g),{sources:r,fetchSources:a}=(()=>{const[e,t]=o.exports.useState([]),{getSources:r}=m();return{sources:e,fetchSources:o.exports.useCallback((e=>{let a=!1;return r(e).then((e=>{if("error"===e.status)return alert(e.message),void(a||t([]));a||t(e.sources)})),()=>{a=!0}}),[r])}})();return o.exports.useEffect((()=>{a({language:t})}),[t]),u.createElement(b,{sources:r,onSelect:e})};function C(){const[e,t]=o.exports.useState(""),[r,a]=o.exports.useState(navigator.language.slice(0,2)),[n,s]=o.exports.useState([]);return u.createElement(g.Provider,{value:{apiKey:"dcb61b8315814676883fa679808f9059",pageSize:20,search:e,language:r,sourceIds:n}},u.createElement("div",{id:"sidebar",className:"flex flex-col gap-2 h-screen max-h-[calc(100vh-2rem)] sticky top-4"},u.createElement(y,{onChange:t}),u.createElement(E,{onChange:a}),u.createElement(N,{onChange:s})),u.createElement(x,null))}i.render(u.createElement(u.StrictMode,null,u.createElement(C,null)),document.getElementById("root"));
